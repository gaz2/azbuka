"use strict";Object.defineProperty(exports, "__esModule", {value: true}); function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; } function _optionalChain(ops) { let lastAccessLHS = undefined; let value = ops[0]; let i = 1; while (i < ops.length) { const op = ops[i]; const fn = ops[i + 1]; i += 2; if ((op === 'optionalAccess' || op === 'optionalCall') && value == null) { return undefined; } if (op === 'access' || op === 'optionalAccess') { lastAccessLHS = value; value = fn(value); } else if (op === 'call' || op === 'optionalCall') { value = fn((...args) => value.call(lastAccessLHS, ...args)); lastAccessLHS = undefined; } } return value; }var _chunkJPD77S2Tjs = require('./chunk-JPD77S2T.js');var _chunkWKIT6B4Wjs = require('./chunk-WKIT6B4W.js');require('./chunk-4BZQND6X.js');var _pluginutils = require('@rollup/pluginutils');var _debug = require('debug'); var _debug2 = _interopRequireDefault(_debug);var _url = require('url');function P(t){return t.split(".").pop()==="js"?"script":"link"}function A(t,e,r){return(typeof e=="function"?e(t,r.extra):e).replace(/\[version\]/,r.extra.version).replace(/\[baseURL\]/,r.baseURL).replace(/\[name\]/,r.extra.name)}function C(t,e,r){let{version:i,name:c,relativeModule:u,resolve:s}=t;if(!e)return;let o=r?r(e,t):new (0, _url.URL)(`${c}@${i}/${u}`,e).href;return s?A(o,s,{extra:t,baseURL:e}):o}function E(t){return{tag:"link",url:new Set,name:t.name,extra:t}}var h=class{constructor(e,r,i){this.modules=this.prepareSource(e,r,i)}toTags(){let e=[];return this.modules.forEach(r=>{let{tag:i,url:c,name:u,extra:s,...o}=r;c.size&&c.forEach(n=>{let l={tag:i,injectTo:"head-prepend",attrs:{}};l.attrs[i==="script"?"src":"href"]=n;for(let a in o)l.attrs[a]=o[a];e.push(l)})}),e}calledHook(e){if(e){let r=e();this.modules.forEach(i=>{i.tag==="script"&&_optionalChain([r, 'access', _2 => _2.script, 'optionalCall', _3 => _3(i)]),i.tag==="link"&&_optionalChain([r, 'access', _4 => _4.link, 'optionalCall', _5 => _5(i)])})}}prepareSource(e,r,i){let c=new Map,u=(s,o)=>{let{spare:n}=s;if(!n)return;if(Array.isArray(n)){for(let m of _chunkWKIT6B4Wjs.a.call(void 0, n))u({...s,spare:m},o);return}let l=P(n),a=`__${o}__${l}__`;if(c.has(a)){c.get(a).url.add(n);return}let d=E(s);d.url.add(n),d.tag=P(n),c.set(a,d)};return e.forEach((s,o)=>{let n=E(s),l=C(s,r,i);if(!l)return;n.url.add(l),n.tag=P(l);let a=`__${o}__${n.tag}__`;c.set(a,n),s.spare&&u(s,o)}),c}};function S(t,e,r){return new h(t,e,r)}var N=_debug2.default.call(void 0, "vite-plugin-cdn2");function T(t){let e="node_modules";return{name:"vite-plugin-cdn2:presetModule",transform(r,i){if(t.filter(i)&&i.includes(e))return r=_chunkWKIT6B4Wjs.c.call(void 0, r,t.generator.dependencies),t.generator.filter(r,i)?t.generator.transform(r):{code:r}}}}function F(t={}){let{modules:e=[],url:r=_chunkJPD77S2Tjs.b,include:i=/\.(mjs|js|ts|vue|jsx|tsx)(\?.*|)$/,exclude:c,logLevel:u="warn",resolve:s,apply:o="build"}=t,n=_chunkWKIT6B4Wjs.f.call(void 0, e),{transform:l,api:a}=$({modules:[],include:i,exclude:c}),d=a;return[{...(()=>({name:"vite-plugin-cdn2:transform",enforce:"post",apply:o,async configResolved(p){let[f,R]=_chunkWKIT6B4Wjs.b.call(void 0, );try{if(!f)throw new Error(`vite-plugin-cdn2 can't work with nodejs ${R}.`);let x=p.root;if(n.setDefaultWd(x),N("start scanning"),n.scanAllDependencies(),N("scanning done",n.dependencies),d.generator.injectDependencies(n.dependencies),u==="warn"&&n.failedModules.forEach((g,v)=>p.logger.error(`vite-plugin-cdn2: ${v} ${g||"resolved failed.Please check it."}`)),o==="serve"){let g=_optionalChain([p, 'access', _6 => _6.optimizeDeps, 'optionalAccess', _7 => _7.exclude])||[];p.optimizeDeps.exclude=[...g,...n.dependencies.keys()];let v=_optionalChain([p, 'access', _8 => _8.optimizeDeps, 'optionalAccess', _9 => _9.include])||[];p.optimizeDeps.include=v.filter(O=>!p.optimizeDeps.exclude.includes(O))}}catch(x){p.logger.error(x)}},transform:l,transformIndexHtml(p){let f=S(n.dependencies,r,s);return f.calledHook(t.transform),{html:p,tags:f.toTags()}}}))(),apply:o},{...T(d),apply:o}]}function $(t={}){let e=_debug2.default.call(void 0, "vite-plugin-external"),{modules:r=[],include:i,exclude:c}=t,u=_pluginutils.createFilter.call(void 0, i,c),s=_chunkWKIT6B4Wjs.d.call(void 0, );return{name:"vite-plugin-external",async buildStart(){try{e("start check modules");for(let a of r)if(!a.global)throw new Error(`vite-plugin-external: missing global for module ${a.name}`);e("check done");let o=process.cwd(),n=await Promise.all(r.map(async a=>({bindings:await _chunkWKIT6B4Wjs.e.call(void 0, a,o),...a}))),l=new Map(n.map(a=>[a.name,a]));e("scanning done",l),s.injectDependencies(l)}catch(o){this.error(o)}},async transform(o,n){if(u(n)&&s.filter(o,n))return s.transform(o)},api:{filter:u,generator:s}}}$.getExternalPluginAPI=t=>_optionalChain([t, 'access', _10 => _10.find, 'call', _11 => _11(e=>e.name==="vite-plugin-external"), 'optionalAccess', _12 => _12.api]);var Q=F;exports.cdn = F; exports.default = Q; exports.external = $;
